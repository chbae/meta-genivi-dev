From 9ccdc06bf94a0cc8f1678bad7581237e2d18eae9 Mon Sep 17 00:00:00 2001
From: Changhyeok Bae <changhyeok.bae@lge.com>
Date: Fri, 20 Jan 2017 22:48:05 +0900
Subject: [PATCH 2/2] add support for IVI-Surface-ID property

---
 src/client/qwaylandwindow.cpp | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/src/client/qwaylandwindow.cpp b/src/client/qwaylandwindow.cpp
index 8885c0e..0d02186 100644
--- a/src/client/qwaylandwindow.cpp
+++ b/src/client/qwaylandwindow.cpp
@@ -41,6 +41,7 @@
 #include "qwaylandshellsurface_p.h"
 #include "qwaylandwlshellsurface_p.h"
 #include "qwaylandxdgsurface_p.h"
+#include "qwaylandivisurface_p.h"
 #include "qwaylandsubsurface_p.h"
 #include "qwaylandabstractdecoration_p.h"
 #include "qwaylandwindowmanagerintegration_p.h"
@@ -57,6 +58,8 @@
 
 #include <QtCore/QDebug>
 
+#define IVI_SURFACE_ID 8000
+
 QT_BEGIN_NAMESPACE
 
 namespace QtWaylandClient {
@@ -123,7 +126,17 @@ void QWaylandWindow::initWindow()
             mSubSurfaceWindow = new QWaylandSubSurface(this, p, ss);
         }
     } else if (shouldCreateShellSurface()) {
-        mShellSurface = mDisplay->createShellSurface(this);
+        if (mDisplay->shellIvi()) {
+            unsigned int id = 0;
+            QVariant value = window()->property("IVI-Surface-ID");
+            if (value.isValid()) {
+                id = value.toUInt();
+            } else {
+                id = IVI_SURFACE_ID + getpid();
+            }
+            mShellSurface = new QWaylandIviSurface(mDisplay->shellIvi()->surface_create(id, object()), this);
+        } else
+            mShellSurface = mDisplay->createShellSurface(this);
     }
 
     if (mShellSurface) {
-- 
1.9.1

